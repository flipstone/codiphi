#!/usr/bin/env ruby
bin_path = File.expand_path(File.dirname(__FILE__))
BASE_PATH = File.join(bin_path, '../')

require_relative './codiphi_run'
require 'json'
require 'polyglot'
require 'treetop'
Dir["#{BASE_PATH}lib/codiphi/*.rb"].each {|file| require file }
Dir["#{BASE_PATH}lib/modules/*.rb"].each {|file| require file }
Dir["#{BASE_PATH}lib/codiphi/**/*.rb"].each {|file| require file }

include SayLogging

#
# Arguments
#
if ARGV.length != 2
  puts "Usage: codiphi <command> <list_json>"
  exit(1)
end

command, list_json = *ARGV

#
# load list_json
#
data = {}
say "loading json file at #{list_json}" do
  data = read_json(list_json)
end

case command.to_sym
when :emit
  emit(data)
end

